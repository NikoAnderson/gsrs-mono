<mat-card>
  <div fxLayout="row" fxLayoutAlign="space-between start">
    <div fxFlex="100">
      <span class="mat-h2">{{trial.officialTitle}}</span>
    </div>
  </div>

  <div fxLayout="row" fxLayoutAlign="space-between start">
    <div fxFlex="70">
      <span *ngIf="trial">{{trial.lastUpdatePostDate}}</span>
      <div fxLayout="row" fxLayoutAlign="start start">
        <div fxFlex="20" class = "mat-h3" *ngIf = "trial.NCTId">NCT ID:
          <a
            href="https://clinicaltrials.gov/ct2/show/{{trial.NCTId}}"
            target="_blank"
            rel="noreferrer"
            aria-label="Link to clinical trial in at Clinicaltrials.gov"
          >{{trial.NCTId}}</a></div>
      </div>
    </div>
    <div fxFlex="25">
      <span class = "mat-h3">Study Type: </span> {{trial.studyType}}<br>
      <span class = "mat-h3" *ngIf = "trial.overallStatus || trial.lastKnownStatus">Status: </span> {{trial.overallStatus || trial.lastKnownStatus}}<br>
      <span class = "mat-h3" *ngIf="trial.phase">Phase: </span><span>{{trial.phase}}</span>
      <span class = "mat-h3" *ngIf="trial.studyFirstPostDate">First Posted: </span><span>{{trial.studyFirstPostDate}}</span>
      <span class = "mat-h3" *ngIf="trial.lastUpdatePostDate">Last Update: </span><span>{{trial.lastUpdatePostDate}}</span>
    </div>

  </div>
  <mat-card-subtitle *ngIf="trial.briefSummary && trial.briefSummary.length">Summary</mat-card-subtitle>
  <div *ngIf="fullSummary; else truncated">
    <span class="mat-body-1">{{getTrialSummary()}}</span>
    <a (click) = "fullSummary = false" *ngIf="fullSummary && truncatedSummary" class = "expand-link"> ...less</a>
  </div>
  <ng-template #truncated>
    <span class="mat-body-1">{{getTrialSummary()}}</span>
    <a (click) = "fullSummary = true" *ngIf="!fullSummary" class = "expand-link"> ...more</a>
  </ng-template>


  <mat-tab-group dynamicHeight>
    <mat-tab [label]= "getLabel('studyDesigns')" [disabled]="!trial.studyDesigns || trial.studyDesigns.length === 0">
      <div *ngFor="let studyDesign of trial.studyDesigns">
      <mat-list>
        <mat-list-item *ngIf="studyDesign.designPrimaryPurpose">
          Primary Purpose: {{studyDesign.designPrimaryPurpose}}
        </mat-list-item>
        <mat-list-item *ngIf="studyDesign.designInterventionModel">
          Intervention Model: {{studyDesign.designInterventionModel}}
        </mat-list-item>
        <mat-list-item *ngIf="studyDesign.designInterventionModelDescription">
          Intervention Model Description: {{studyDesign.designInterventionModelDescription}}
        </mat-list-item>
        <mat-list-item *ngIf="studyDesign.designMasking">
          Design Masking: {{studyDesign.designMasking}}
        </mat-list-item>
        <mat-list-item *ngIf="studyDesign.designMaskingDescription">
          Design Masking Description: {{studyDesign.designMaskingDescription}}
        </mat-list-item>
        <mat-list-item *ngIf="studyDesign.designAllocation">
          Design Allocation: {{studyDesign.designAllocation}}
        </mat-list-item>
        <mat-list-item *ngIf="studyDesign.designObservationalModel">
          Design Observational Model: {{studyDesign.designObservationalModel}}
        </mat-list-item>
        <mat-list-item *ngIf="studyDesign.designTimePerspective">
         Design Time Perspective: {{studyDesign.designTimePerspective}}
        </mat-list-item>
        <mat-list-item *ngIf="studyDesign.samplingMethod">
          Sampling Method: {{studyDesign.samplingMethod}}
        </mat-list-item>
        <mat-list-item *ngIf="studyDesign.primaryOutcomeDescription">
          Primary Outcome Description: {{studyDesign.primaryOutcomeDescription}}
        </mat-list-item>
        <mat-list-item *ngIf="studyDesign.primaryOutcomeMeasure">
          Primary Outcome Measure: {{studyDesign.primaryOutcomeMeasure}}
        </mat-list-item>
        <mat-list-item *ngIf="studyDesign.primaryOutcomeTimeFrame">
          Primary Outcome Timeframe: {{studyDesign.primaryOutcomeTimeFrame}}
        </mat-list-item>
      </mat-list>
      <p *ngIf="studyDesign.detailedDescription">
        Detailed Description: {{studyDesign.detailedDescription}}
      </p>
      </div>
    </mat-tab>
    <mat-tab [label]= "getLabel('participantInfo', false)" [disabled]="!trial.participantInfo || trial.participantInfo.length === 0">
      <mat-list>
        <mat-list-item *ngFor="let participant of trial.participantInfo">
          {{participant.eligibilityCriteria}}
        </mat-list-item>
      </mat-list>
      {{trial.participantInfo | json}}
    </mat-tab>
    <mat-tab  [label]= "getLabel('studyDiseases')" [disabled]="!trial.studyDiseases || trial.studyDiseases.length <= 1">
      <mat-list>
        <mat-list-item *ngFor="let disease of trial.studyDiseases">
          <ng-container *ngIf="disease.gard_id; then link; else nolink">
          </ng-container>
          <ng-template #link>
            <a href="/disease?id={{disease.gard_id}}"
               target="_blank"
               rel="noreferrer"
               aria-label="Link to disease details page">{{disease.name}}</a>
          </ng-template>
          <ng-template #nolink>
            {{disease.name}}
          </ng-template>
        </mat-list-item>
      </mat-list>
    </mat-tab>

    <mat-tab [label]= "getLabel('conditions')" [disabled]="!trial.conditions || trial.conditions.length === 0">
      <mat-list>
      <mat-list-item *ngFor="let condition of trial.conditions">
        {{condition.condition}}
      </mat-list-item>
      </mat-list>
    </mat-tab>
    <mat-tab [label]= "getLabel('locations')" [disabled]="!trial.locations || trial.locations.length === 0">
      <mat-list *ngFor="let location of trial.locations">
        <mat-list-item>
          <div>{{location.locationFacility}}</div>
        </mat-list-item>
        <mat-list-item>
          <span *ngIf="location.locationCity"> {{location.locationCity}}<span *ngIf="location.locationState || location.locationCountry">,</span>&nbsp;</span>
          <span *ngIf="location.locationState"> {{location.locationState}}&nbsp;</span>
        <span *ngIf="location.locationCountry">{{location.locationCountry}}&nbsp;</span>
          <span *ngIf="location.locationZip">{{location.locationZip}}&nbsp;</span>
        </mat-list-item>
        <mat-list-item>
        <span *ngIf="location.locationStatus">Status: {{location.locationStatus}}</span>
        </mat-list-item>
      </mat-list>
    </mat-tab>
    <mat-tab [label]= "getLabel('sponsors')" [disabled]="!trial.sponsors || trial.sponsors.length === 0">
      <mat-list>
        <mat-list-item *ngFor="let sponsor of trial.sponsors">
          <span *ngIf="sponsor.leadSponsorName">{{sponsor.leadSponsorName}}</span> <span *ngIf="sponsor.leadSponsorClass">: &nbsp;{{sponsor.leadSponsorClass}}</span>
        </mat-list-item>
      </mat-list>
    </mat-tab>
    <mat-tab [label]= "getLabel('interventions')" [disabled]="!trial.interventions || trial.interventions.length === 0">
      <mat-list>
        <mat-list-item *ngFor="let intervention of trial.interventions">
         <span *ngIf="intervention.interventionType"> {{intervention.interventionType}}: &nbsp;</span>
         <span *ngIf="intervention.interventionName"> {{intervention.interventionName}}</span>
        </mat-list-item>
      </mat-list>
    </mat-tab>
    <mat-tab  [label]= "getLabel('references')" [disabled]="!trial.references || trial.references.length === 0">
      <mat-list>
        <mat-list-item *ngFor="let reference of trial.references">
          <ng-container *ngIf="reference.referencePMID; then link; else nolink">
          </ng-container>
          <ng-template #link>
            <a href="https://pubmed.ncbi.nlm.nih.gov/{{reference.referencePMID}}"
               target="_blank"
               rel="noreferrer"
               aria-label="Link to publication in PubMed">{{reference.referenceCitation}}</a>
          </ng-template>
          <ng-template #nolink>
            {{reference.referenceCitation}}
          </ng-template>
        </mat-list-item>
      </mat-list>
    </mat-tab>
  </mat-tab-group>

</mat-card>
