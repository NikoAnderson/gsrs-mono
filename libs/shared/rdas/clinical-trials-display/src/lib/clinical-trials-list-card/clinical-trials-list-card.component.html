<mat-card>
  <mat-card-title>
    <div class="row space-between-row">
      <div class="width-75">
        {{trial.officialTitle}}
      </div>
      <div class="mat-h3" *ngIf="trial.NCTId">
        <a
          href="https://clinicaltrials.gov/ct2/show/{{trial.NCTId}}"
          target="_blank"
          rel="noreferrer"
          aria-label="Link to clinical trial in at Clinicaltrials.gov"
        >{{trial.NCTId}}</a></div>
    </div>
  </mat-card-title>
  <mat-card-content>
     <b>Study Type: </b> {{trial.studyType}}<br>
        <b *ngIf="trial.overallStatus || trial.lastKnownStatus">Status: </b> {{trial.overallStatus || trial.lastKnownStatus}}
        <br>
        <span *ngIf="trial.phase"><b>Phase: </b>{{trial.phase}}</span><br>
    <b *ngIf="trial.studyFirstPostDate">First Posted: </b><span>{{trial.studyFirstPostDate}}</span><br>
        <b *ngIf="trial.lastUpdatePostDate">Last Update: </b><span>{{trial.lastUpdatePostDate}}</span>
    <br>
    <br>
    <div class="row space-between-row">
    <div class="mat-h2" *ngIf="trial.briefSummary && trial.briefSummary.length">Summary</div>
    <div *ngIf="fullSummary; else truncated">
      <span class="mat-subtitle-2">{{getTrialSummary()}}</span>
      <a (click)="fullSummary = false" *ngIf="fullSummary && truncatedSummary" class="expand-link"> ...less</a>
    </div>
    <ng-template #truncated>
      <span class="mat-subtitle-2">{{getTrialSummary()}}</span>
      <a (click)="fullSummary = true" *ngIf="!fullSummary" class="expand-link"> ...more</a>
    </ng-template>
    </div>
    <div class="row">
        <mat-tab-group [color]="'primary'">
        <mat-tab [label]="getLabel('studyDesigns')"
                 [disabled]="!trial.studyDesigns || trial.studyDesigns.length === 0">
          <div *ngFor="let studyDesign of trial.studyDesigns">
            <mat-list>
              <mat-list-item *ngIf="studyDesign.designPrimaryPurpose">
                Primary Purpose: {{studyDesign.designPrimaryPurpose}}
              </mat-list-item>
              <mat-list-item *ngIf="studyDesign.designInterventionModel">
                Intervention Model: {{studyDesign.designInterventionModel}}
              </mat-list-item>
              <mat-list-item *ngIf="studyDesign.designInterventionModelDescription">
                Intervention Model Description: {{studyDesign.designInterventionModelDescription}}
              </mat-list-item>
              <mat-list-item *ngIf="studyDesign.designMasking">
                Design Masking: {{studyDesign.designMasking}}
              </mat-list-item>
              <mat-list-item *ngIf="studyDesign.designMaskingDescription">
                Design Masking Description: {{studyDesign.designMaskingDescription}}
              </mat-list-item>
              <mat-list-item *ngIf="studyDesign.designAllocation">
                Design Allocation: {{studyDesign.designAllocation}}
              </mat-list-item>
              <mat-list-item *ngIf="studyDesign.designObservationalModel">
                Design Observational Model: {{studyDesign.designObservationalModel}}
              </mat-list-item>
              <mat-list-item *ngIf="studyDesign.designTimePerspective">
                Design Time Perspective: {{studyDesign.designTimePerspective}}
              </mat-list-item>
              <mat-list-item *ngIf="studyDesign.samplingMethod">
                Sampling Method: {{studyDesign.samplingMethod}}
              </mat-list-item>
             <!-- <mat-list-item *ngIf="studyDesign.primaryOutcomeDescription">
                Primary Outcome Description: {{studyDesign.primaryOutcomeDescription}}
              </mat-list-item>-->
              <mat-list-item  *ngIf="studyDesign.primaryOutcomeMeasure">
                Primary Outcome Measure: {{studyDesign.primaryOutcomeMeasure}}
              </mat-list-item>
              <mat-list-item *ngIf="studyDesign.primaryOutcomeTimeFrame">
                Primary Outcome Timeframe: {{studyDesign.primaryOutcomeTimeFrame}}
              </mat-list-item>
            </mat-list>
            <p *ngIf="studyDesign.detailedDescription">
              Detailed Description: {{studyDesign.detailedDescription}}
            </p>
          </div>
        </mat-tab>
        <mat-tab [label]="getLabel('participantInfo', false)"
                 [disabled]="!trial.participantInfo || trial.participantInfo.length === 0">
          <mat-list>
            <mat-list-item *ngFor="let participant of trial.participantInfo">
              {{participant.eligibilityCriteria}}
            </mat-list-item>
          </mat-list>
          {{trial.participantInfo | json}}
        </mat-tab>
        <mat-tab [label]="getLabel('studyDiseases')"
                 [disabled]="!trial.studyDiseases || trial.studyDiseases.length <= 1">
          <mat-list>
            <mat-list-item *ngFor="let disease of trial.studyDiseases">
              <ng-container *ngIf="disease.gard_id; then link; else nolink">
              </ng-container>
              <ng-template #link>
                <a href="/disease?id={{disease.gard_id}}"
                   target="_blank"
                   rel="noreferrer"
                   aria-label="Link to disease details page">{{disease.name}}</a>
              </ng-template>
              <ng-template #nolink>
                {{disease.name}}
              </ng-template>
            </mat-list-item>
          </mat-list>
        </mat-tab>
        <mat-tab [label]="getLabel('conditions')" [disabled]="!trial.conditions || trial.conditions.length === 0">
          <mat-list>
            <mat-list-item *ngFor="let condition of trial.conditions">
              {{condition.condition}}
            </mat-list-item>
          </mat-list>
        </mat-tab>
        <mat-tab [label]="getLabel('locations')" [disabled]="!trial.locations || trial.locations.length === 0">
          <mat-list *ngFor="let location of trial.locations">
            <mat-list-item>
              <div>{{location.locationFacility}}</div>
            </mat-list-item>
            <mat-list-item>
                <span *ngIf="location.locationCity"> {{location.locationCity}}<span
                  *ngIf="location.locationState || location.locationCountry">,</span>&nbsp;</span>
              <span *ngIf="location.locationState"> {{location.locationState}}&nbsp;</span>
              <span *ngIf="location.locationCountry">{{location.locationCountry}}&nbsp;</span>
              <span *ngIf="location.locationZip">{{location.locationZip}}&nbsp;</span>
            </mat-list-item>
            <mat-list-item>
              <span *ngIf="location.locationStatus">Status: {{location.locationStatus}}</span>
            </mat-list-item>
          </mat-list>
        </mat-tab>
        <mat-tab [label]="getLabel('sponsors')" [disabled]="!trial.sponsors || trial.sponsors.length === 0">
          <mat-list>
            <mat-list-item *ngFor="let sponsor of trial.sponsors">
              <span *ngIf="sponsor.leadSponsorName">{{sponsor.leadSponsorName}}</span> <span
              *ngIf="sponsor.leadSponsorClass">: &nbsp;{{sponsor.leadSponsorClass}}</span>
            </mat-list-item>
          </mat-list>
        </mat-tab>
        <mat-tab [label]="getLabel('interventions')"
                 [disabled]="!trial.interventions || trial.interventions.length === 0">
          <mat-list>
            <mat-list-item *ngFor="let intervention of trial.interventions">
              <span *ngIf="intervention.interventionType"> {{intervention.interventionType}}: &nbsp;</span>
              <span *ngIf="intervention.interventionName"> {{intervention.interventionName}}</span>
            </mat-list-item>
          </mat-list>
        </mat-tab>
        <mat-tab [label]="getLabel('references')" [disabled]="!trial.references || trial.references.length === 0">
          <mat-list>
            <mat-list-item *ngFor="let reference of trial.references">
              <ng-container *ngIf="reference.referencePMID; then link; else nolink">
              </ng-container>
              <ng-template #link>
                <a href="https://pubmed.ncbi.nlm.nih.gov/{{reference.referencePMID}}"
                   target="_blank"
                   rel="noreferrer"
                   aria-label="Link to publication in PubMed">{{reference.referenceCitation}}</a>
              </ng-template>
              <ng-template #nolink>
                {{reference.referenceCitation}}
              </ng-template>
            </mat-list-item>
          </mat-list>
        </mat-tab>
      </mat-tab-group>
      </div>
  </mat-card-content>
</mat-card>
