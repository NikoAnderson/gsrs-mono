<mat-card>
  <mat-card-title>
    <div class="row space-between-row">
      <div class="width-75">
        {{trial.officialTitle}}
      </div>
      <div class="mat-h3" *ngIf="trial.NCTId">
        <a
          href="https://clinicaltrials.gov/ct2/show/{{trial.NCTId}}"
          target="_blank"
          rel="noreferrer"
          aria-label="Link to clinical trial in at Clinicaltrials.gov"
        >{{trial.NCTId}}</a></div>
    </div>
  </mat-card-title>
  <mat-card-content>
    <div class="row space-between-row">
      <div class="width-75">
        <div class="primary-chip">Study Type</div>
        <div class="list-item-content">{{trial.studyType ? trial.studyType : 'None Listed'}}</div>
        <div class="primary-chip">Status</div>
        <div class="list-item-content">{{trial.overallStatus || trial.lastKnownStatus}}</div>
        <div class="primary-chip">Phase</div>
        <div class="list-item-content">{{trial.phase && trial.phase.length ? trial.phase.join(", ") : 'None Listed'}}</div>
      </div>

        <div>
        <div class="primary-chip">First Posted</div>
        <div class="list-item-content">{{trial.studyFirstPostDate ? trial.studyFirstPostDate : 'Unknown'}}</div>
        <div class="primary-chip">Last Update</div>
        <div class="list-item-content">{{trial.lastUpdatePostDate}}</div>
        </div>
    </div>


    <div *ngIf="trial.briefSummary && trial.briefSummary.length" class="primary-chip">Summary</div>
    <br>
    <div *ngIf="fullSummary; else truncated">
      <span class="mat-subtitle-2">{{getTrialSummary()}}</span>
      <a (click)="fullSummary = false" *ngIf="fullSummary && truncatedSummary" class="expand-link"> ...less</a>
    </div>
    <ng-template #truncated>
      <span class="mat-subtitle-2">{{getTrialSummary()}}</span>
      <a (click)="fullSummary = true" *ngIf="!fullSummary" class="expand-link"> ...more</a>
    </ng-template>
    <br>
    <br>

        <mat-tab-group [backgroundColor]="'accent'" [dynamicHeight]=true mat-align-tabs="start" mat-stretch-tabs="true">
        <mat-tab [label]="getLabel('studyDesigns')"
                 [disabled]="!trial.studyDesigns || trial.studyDesigns.length === 0">
          <br>
          <br>
          <div *ngFor="let studyDesign of trial.studyDesigns">
              <div *ngIf="studyDesign.designPrimaryPurpose">
                <div class="accent-chip">Primary Purpose</div>
                <div class="list-item-content">{{studyDesign.designPrimaryPurpose}}</div>
              </div>
              <div *ngIf="studyDesign.designInterventionModel">
                <div class="accent-chip">Intervention Model</div>
                <div class="list-item-content">{{studyDesign.designInterventionModel}}</div>
              </div>
              <div *ngIf="studyDesign.designInterventionModelDescription">
                <div class="accent-chip">Intervention Model Description</div>
                <div class="list-item-content">{{studyDesign.designInterventionModelDescription}}</div>
              </div>
              <div *ngIf="studyDesign.designMasking">
                <div class="accent-chip">Design Masking</div>
                <div class="list-item-content">{{studyDesign.designMasking}}</div>
              </div>
              <div *ngIf="studyDesign.designMaskingDescription">
                <div class="accent-chip">Design Masking Description</div>
                <div class="list-item-content">{{studyDesign.designMaskingDescription}}</div>
              </div>
              <div *ngIf="studyDesign.designAllocation">
                <div class="accent-chip">Design Allocation</div>
                <div class="list-item-content">{{studyDesign.designAllocation}}</div>
              </div>
              <div *ngIf="studyDesign.designObservationalModel">
                <div class="accent-chip">Design Observational Model</div>
                <div class="list-item-content">{{studyDesign.designObservationalModel}}</div>
              </div>
              <div *ngIf="studyDesign.designTimePerspective">
                <div class="accent-chip">Design Time Perspective</div>
                <div class="list-item-content">{{studyDesign.designTimePerspective}}</div>
              </div>
              <div *ngIf="studyDesign.samplingMethod">
                <div class="accent-chip">Sampling Method</div>
                <div class="list-item-content">{{studyDesign.samplingMethod}}</div>
              </div>
              <div *ngIf="studyDesign.primaryOutcomeDescription">
                <div class="accent-chip">Primary Outcome Description</div>
                <div class="list-item-content">{{studyDesign.primaryOutcomeDescription}}</div>
              </div>
              <div *ngIf="studyDesign.primaryOutcomeMeasure">
                <div class="accent-chip">Primary Outcome Measure</div>
                <div class="list-item-content">{{studyDesign.primaryOutcomeMeasure}}</div>
              </div>
              <div *ngIf="studyDesign.primaryOutcomeTimeFrame">
                <div class="accent-chip">Primary Outcome Timeframe</div>
                <div class="list-item-content">{{studyDesign.primaryOutcomeTimeFrame}}</div>
              </div>
            <div *ngIf="studyDesign.detailedDescription">
              <div class="accent-chip">Detailed Description</div>
              <div class="list-item-content">{{studyDesign.detailedDescription}}</div>
            </div>
          </div>
        </mat-tab>
        <mat-tab [label]="getLabel('participantInfo', false)"
                 [disabled]="!trial.participantInfo || trial.participantInfo.length === 0">
          <mat-list>
            <mat-list-item *ngFor="let participant of trial.participantInfo">
              {{participant.eligibilityCriteria}}
            </mat-list-item>
          </mat-list>
        </mat-tab>
        <mat-tab [label]="getLabel('studyDiseases')"
                 [disabled]="!trial.studyDiseases || trial.studyDiseases.length <= 1">
          <mat-list>
            <mat-list-item *ngFor="let disease of trial.studyDiseases">
              <ng-container *ngIf="disease.gardId; then link; else nolink">
              </ng-container>
              <ng-template #link>
                <a href="/disease?id={{disease.gardId}}"
                   target="_blank"
                   rel="noreferrer"
                   aria-label="Link to disease details page">{{disease.name}}</a>
              </ng-template>
              <ng-template #nolink>
                {{disease.name}}
              </ng-template>
            </mat-list-item>
          </mat-list>
        </mat-tab>
        <mat-tab [label]="getLabel('conditions')" [disabled]="!trial.conditions || trial.conditions.length === 0">
          <mat-list>
            <mat-list-item *ngFor="let condition of trial.conditions">
              {{condition.condition}}
            </mat-list-item>
          </mat-list>
        </mat-tab>
        <mat-tab [label]="getLabel('locations')" [disabled]="!trial.locations || trial.locations.length === 0">
          <mat-list *ngFor="let location of trial.locations">
            <mat-list-item>
              <div>{{location.locationFacility}}</div>
            </mat-list-item>
            <mat-list-item>
                <span *ngIf="location.locationCity"> {{location.locationCity}}<span
                  *ngIf="location.locationState || location.locationCountry">,</span>&nbsp;</span>
              <span *ngIf="location.locationState"> {{location.locationState}}&nbsp;</span>
              <span *ngIf="location.locationCountry">{{location.locationCountry}}&nbsp;</span>
              <span *ngIf="location.locationZip">{{location.locationZip}}&nbsp;</span>
            </mat-list-item>
            <mat-list-item>
              <span *ngIf="location.locationStatus">Status: {{location.locationStatus}}</span>
            </mat-list-item>
          </mat-list>
        </mat-tab>
        <mat-tab [label]="getLabel('sponsors')" [disabled]="!trial.sponsors || trial.sponsors.length === 0">

            <div *ngFor="let sponsor of trial.sponsors">
              <div class="accent-chip" *ngIf="sponsor.leadSponsorClass">{{sponsor.leadSponsorClass}}</div>
              <div class="list-item-content" *ngIf="sponsor.leadSponsorName">{{sponsor.leadSponsorName}}</div>
            </div>
        </mat-tab>
        <mat-tab [label]="getLabel('interventions')"
                 [disabled]="!trial.interventions || trial.interventions.length === 0">
            <div *ngFor="let intervention of trial.interventions">
              <div class="accent-chip"  *ngIf="intervention.interventionType">{{intervention.interventionType}} </div>
              <div class="list-item-content" *ngIf="intervention.interventionName">{{intervention.interventionName}}</div>
            </div>
        </mat-tab>
        <mat-tab [label]="getLabel('references')" [disabled]="!trial.references || trial.references.length === 0">
          <mat-list>
            <mat-list-item *ngFor="let reference of trial.references">
              <ng-container *ngIf="reference.referencePMID; then link; else nolink">
              </ng-container>
              <ng-template #link>
                <a href="https://pubmed.ncbi.nlm.nih.gov/{{reference.referencePMID}}"
                   target="_blank"
                   rel="noreferrer"
                   aria-label="Link to publication in PubMed">{{reference.referenceCitation}}</a>
              </ng-template>
              <ng-template #nolink>
                {{reference.referenceCitation}}
              </ng-template>
            </mat-list-item>
          </mat-list>
        </mat-tab>
      </mat-tab-group>
  </mat-card-content>
</mat-card>
